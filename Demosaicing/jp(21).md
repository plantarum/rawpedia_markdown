<span style="color: #000000; background: none; overflow: hidden; page-break-after: avoid; font-size: 2.0em; font-family: Georgia,Times,serif; margin-top: 1em; margin-bottom: 0.25em; line-height: 1.3; padding: 0; border-bottom: 1px solid #AAAAAA;">デモザイク
</span>

![](Chipincamera.jpg "Chipincamera.jpg")
![](Bayer_pattern_on_sensor.svg "Bayer_pattern_on_sensor.svg")
　今日のデジタルカメラの殆どが撮像素子に[カラーフィルター配列](https://en.wikipedia.org/wiki/Color_filter_array)（英語）を使っています。これらカメラで撮影されたrawファイルを表示するためには[デモザイク処理(英語）](http://www.cambridgeincolour.com/tutorials/camera-sensors.htm)が必要となります。\[<https://ja.wikipedia.org/wiki/Foveon_X3>　FoveonX3センサー\]
（シグマ）を使ったカメラだけは、カラーフィルター配列を使っていないので、デモザイク処理は必要ありません。初めてrawファイルを開く時だけは、表示のための調整が既に行われている\[<https://ja.wikipedia.org/wiki/JPEG>　JPEG\]や\[<https://ja.wikipedia.org/wiki/Tagged_Image_File_Format>　TIFF\]ファイルを開く時より多少時間がかかります。RawTherapeeは複数のデモザイクのアルゴリズムを用意しており、それぞれに特色があります。多くの場合は、違いが非常に小さいので、それら自体の違いを見分けるには画像を200％～400％に拡大する必要があります。しかし、現像プログラムは基本的にピクセル単位で作用するので、全ての機能が作用するベースを作るためのデモザイクの選択は、シャープ化などのツールとの組み合わせで視覚的に著しい影響を与えることがあります。一定のデモザイクアルゴリズムは、他のことも含め、偽色の発生や、エッジ部分の正確な色表現など、画像の非常に微細な部分に影響します。

　RawTherapeeは、ベイヤーフィルターと富士フィルムのX-Transフィルターを使っているカメラで撮影された両方のraw画像のデモザイク処理をサポートしています。“raw”タブの中に、“ベイヤー配列を使ったセンサー”と“X-Transマトリクスを使ったセンサー”というメニューが見つかるはずです。一方で行った設定は他方には影響しません。ベイヤー配列を使ったセンサーで撮った画像を開くと、それに合った設定が使われ、X-Transマトリクスのための設定は無視されるように設計されています。逆も同じです。簡単に見分けが付くように両方のケースを表示してあります。

## 方式

　ベイヤー配列を使ったrawファイルのデモザイク処理には以下のアルゴリズムが使えます:

- AMaZE
- IGV
- LMMSE
- EAHD
- HPHD
- VNG4
- DCB
- AHD
- Fast
- Mono
- None(デモザイクなし)

　X-Transフィルターを使ったrawファイルのデモザイク処理には以下のアルゴリズムが使えます：

- 3-Pass
- 1-Pass
- Fast
- Mono
- None(デモザイクなし)

<div align="center">

Image:Demosaicing city1 amaze.png\|AMaZE Image:Demosaicing city1
igv.png\|IGV Image:Demosaicing city1 lmmse.png\|LMMS Image:Demosaicing
city1 eahd.png\|EAHD Image:Demosaicing city1 hphd.png\|HPHD
Image:Demosaicing city1 vng4.png\|VNG4 Image:Demosaicing city1
dcb.png\|DCB Image:Demosaicing city1 ahd.png\|AHD Image:Demosaicing
city1 fast.png\|Fast Image:Demosaicing city1 none.png\|デモザイクなし

</div>

　どのデモザイク処理アルゴリズムを使うべきでしょうか？以下、撮影者にとって重要な様々なアルゴリズムについて説明しますが、それらは直ぐに技術的、プログラム的、数学的な話になってしまいます。ここの説明を読んだ後、高ISOで撮影した場合のrawファイルにはLMMSEやIGV、その他の場合は、殆どAMaZEを使うことが望ましいと解釈するでしょう。しかし、貴方自身が貴方のrawファイルを各アルゴリズムで試してみることが大切です。インターネットのどこかにあるような、試してみた結果、○○のアルゴリズムがシャープでベストであるという記事を鵜呑みにしても意味はありません。各アルゴリズムのパフォーマンスはカメラの撮像センサー、或いはISO値でも変わるからです。ですから、ここに書かれたことは一つの推奨として捉え、自身が試して最も好ましいと感じる方法を選ぶことが肝要です。

　バージョン4.2.91以降のRawTherapeeでは、画像のズームレベルに関わらず選択されたアルゴリズム（デフォルトはAMaZE）が使われます。それより以前のバージョンでは、初めて画像を開いた時はFastが使われ、その後は画像が100％に拡大された場合や、詳細ウィンドウが使われた時に選択されたアルゴリズムが適用されるようになっています。選択されたアルゴリズムはバッチ処理でも使われます。また、最終的な画像の現像には、表示速度を優先させた質の低いアルゴリズムFastを使うことは奨められません。

　**AMaZE**（Aliasing Minimization and Zipper
Elimination）はデフォルトで設定されているデモザイク処理で、殆どの場合、最良の結果をもたらすアルゴリズムです。**VNG-4**は前のバージョン（2.4）でオリンパス製カメラに適しているとされたアルゴリズムで、他のアルゴリズムで発生していた一定のメイズパターンなどのアーティファクトを、取り除くことが出来ました。しかし、バージョン3.0以降は、オリンパス製カメラのユーザーでも、AMaZEの方を選ぶようです。

　**DCB**もAMaZEと似たような結果を生みます。細部のデモザイク処理はAMaZEの方がDCBより多少勝っている場合が多いようですが、偽色の発生に関してはDCBの方がAMaZEに比べ少ないようです、特にアンチエイリアシングフィルター（日本ではローパスフィルターという呼称の方が一般的）が備わっていないカメラでは効果が高いようです。

　高ISOでノイズ低減機能をフルに活用しなければならないようなノイズの多い画像の場合は、
**LMMSE**、或いは**IGV**を使うことを奨めます。メイズパターンの発生を回避しながら、ノイズ低減を強く使うことによる画像の色褪せを回避します。

　中判デジタルカメラに対称型広角レンズ（例、Schneider Digitr
28mm或いは35㎜）を使った場合、画像にクロストークが入り易くなります、特にあおり撮影を行うとその傾向が強まります（レンズからの入光がローアングルなため、漏れた光がセンサーの隣接するピクセルに影響してしまう）、そのためAMaZEやDCBアルゴリズムでは、クロストークによる影響で、グリーンチャンネルが乖離して、メイズアーティファクトを引き起こします。アダプターを使ってミラーレスカメラに広角レンズを使っても、クロストークが入ります。この様な画像の場合は、微細な部分の質が多少犠牲になりますが、VNG-4（Variable
Number of
Gradients）アルゴリズムを使う方がいいでしょう。また、別な手段として、Rawタブの前処理の中の“グリーン平衡化”を使い、グリーンチャンネルの差異を取り除く方法もあります。

　**AHD** (Adaptive Homogeneity-Directed)や **EAHD** (Horvath's AHD) 、
**HPHD** (Heterogeneity-Projection Hard-Decision)
は昔使われていたアルゴリズムで、全般的に動作が遅く、パフォーマンスも他の方法に比べて劣ります。

　**None**はデモザイク処理を行わないとい意味です。これはrawファイルの診断などに使います。現像に使うことはないでしょう。

　**Mono**はモノクロームカメラや、カラーフィルターを外したカメラで撮影したrawファイルのデモザイク処理に使います。

　**Fast**
は動作が速い単純なアルゴリズムですが、デモザイク処理の質は低いので最終画像の現像には奨められません。

　**3-Pass**
はX-Transセンサー（フジ）を使ったカメラで撮影したraw画像のデモザイク処理に使います。名前の通り処理を3回繰り返し、シャープ感を高める効果をもたらしますが、その効果が確認出来るのは低ISO画像だけです。動作は1-Passより遅くなります。

　**1-Pass**
もX-Transセンサー（フジ）を使ったカメラで撮影したraw画像のデモザイク処理に使うアルゴリズムですが、3-Passに比べ動作が速い代わり、質が多少劣ります。但し、それは低ISO画像だけに限ります。よって、高ISO画像の場合、動作速度を重視するのであれば、1-Passで処理しても画像の質に違いは見られないでしょう。

## 偽色抑制処理の回数

　デモザイク処理の際にアーティファクトもデモザイク処理してしまうのを避けるために、中間フィルターを通す回数を設定します。デモザイク処理で高質な微細部分が決定されるところで、偽色（斑模様）が
発生する可能性があるからです。色のスムーズ化調整に似ていますが、この機能は輝度チャン
ネルには影響しません。

　一般的に、ローパスフィルターが備わっていないカメラは、それが備わっているカメラに比べ、偽色の発生が起こり易いと言えます。備考：偽色への対処の重要性に応じて、デモザイクアルゴリズムを選ぶことが決定的要素となるので、最も大切なことです。従って場合によっては、偽色抑制の回数を増やすより（解像度が犠牲になる）、アルゴリズムを変更する方が、結果が良くなる場合があります。

## 最適なデモザイクアルゴリズムを選ぶ

　少なくとも画像を100％（1:1）に拡大して、全てのアルゴリズムを試し、自分にあったものを選ぶべきです。細部や細かい規則的な模様のあるシャープな画像、例えば、規則的な模様のある波打ったセーターの画像や（メイズパターン発生の有無の確認）、遠くのレンガ壁や道路標識の画像を（エイリアシング発生の有無の確認）使います。そして、それらを低ISOと高ISO撮影の両方の画像で確認します。また、これら確認にはご自身のカメラで撮った画像を使って下さい；ニコン製カメラのraw画像に最適なアルゴリズムが、オリンパス製カメラのraw画像に対しても最適であるとは限りません。[thumb\|仕上がりの良い画像で各デモザイクの結果を検証（拡大率800％）。その結果VNG4はペンタックスK10D
のrawファイルには適さないことが分かる。本来ないはずの白い斑点（標識の赤い線の部分など）
が発生しており、レンガ壁（右）の詳細が失われている。](image:demosaicing_city1_example_bad.jpg "wikilink")

## モノクロームカメラ

　モノクロームカメラは全てのピクセルに同じ色のフィルターを使ったカメラで、つまり、白黒イメージが撮影されるので、デモザイクを必要としません。また、この様なカメラの一部は赤外線フィルターも持っておらず、独創的なモノクロ撮影を可能にしています。

　RawTherapeeはモノクロームカメラもサポートしますが、ユーザーインターフェイスはその仕様で作られていないので、モノクロームファイルを読み込んでも、カラーに関する機能は有効のままです（もっとも、それらを調整しても殆ど意味は有りませんが）。モノクロームカメラは特殊なカメラなため、私達の開発努力をその仕様作りのために注ぐことは出来ません。ですから、この種のファイルを入力した際に、カラーの調整機能が無効になる、といった利便性が無いことを御承知おき下さい。

　モノクロームファイルを扱う時には、更に幾つか留意点があります。モノクロームカメラには、Leica
Monochromの様に色を単一チャンネルで記録するものと、Phase One IQ260
Achromaticの様にRGBチャンネルで記録するものが混在します。単一チャンネルだけを記録する機種であれば、RawTherapeeはそれを認識し、デモザイク処理を実行せず（デモザイクセクションにある機能は有効になったままですが、何もしません）、他の操作にも支障はありません。しかし、ベイヤー配列を使うカメラの様にRGBチャンネルで記録する機種に関しては、デモザイク処理が実行され、カラーマトリクスが適用されてしまいます。従って、この様な機種の画像ファイルを扱う場合は、デモザイク処理で“Mono”というオプションを使って下さい。そして、カラーマネジメントの[入力プロファイルを](Color_Management/jp "wikilink")“入力プロファイルなし”に変更して下さい。