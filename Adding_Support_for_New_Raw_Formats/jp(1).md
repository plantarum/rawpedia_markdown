<span style="color: #000000; background: none; overflow: hidden; page-break-after: avoid; font-size: 2.0em; font-family: Georgia,Times,serif; margin-top: 1em; margin-bottom: 0.25em; line-height: 1.3; padding: 0; border-bottom: 1px solid #AAAAAA;">新しいRawフォーマットを追加する
</span>

　RawTherapeeに新しい形式のrawファイルを正確にサポートするための情報を追加するのは簡単です。自分で行うことも出来ますし、新しい形式で撮影した画像を送ってもらい、私達が必要なデータを計測して、そのカメラのサポート情報を追加することも出来ます。

### イントロダクション

　rawファイルを正しく読み込むためには、プログラムがそのファイルに関して何点か知っておく必要がありますが、RawTherapeeはそれらを以下3つの情報源から探します：
　

- 埋め込まれているdcrawコードから
- その新しいraw画像から
- 或いは、camconst.jsonと呼ばれるテキストファイルから

　これら3つの情報源から集めた情報の中で最も重要なのがcamconst.jsonです。集めた情報の中で重複しているものがある場合は、camconst.jsonの情報を優先します。camconst.jsonは、メーカーと機種に関し、カラーチャンネル、ISO値、絞り値の組み合わせで、以下のデータを設定できるからです：

- dcraw形式による、\[<https://ja.wikipedia.org/wiki/D65>　D65光源\]のカラーマトリクス
- ホワイトレベルとブラックレベル
- 偽の列と行を取り去るためのクロップマスク

　このことから、camconst.jsonは新しいraw形式の詳細を簡単に追加できるだけでなく、dcrawだけでは不完全なサポートを向上させることが出来ます。

### 必要な画像

　正確なサポートのために必要な計測値を得るには、一定の条件で撮った何組かの画像が必要です：

1.  画像のどの部分も完全に露出オーバーになっている写真を撮ります。カメラを明るい光源（例えば、空、ランプなど）に向けて撮影を行います。必要であれば、ズームを使い、画像の全ての部分が露出オーバーになるようにします。もちろん、撮影形式はrawで行います。貴方のカメラが、複数サイズのrawで撮影できる場合は、最も大きいサイズを選び、切り抜きはせず、可能ならば非圧縮を使います。
2.  貴方のカメラにノイズリダクション機能が付いている場合はそれをオフにして、上記の写真を撮ります。絞りf/8を使い、貴方のカメラが設定できる各ISO感度で、露出時間が0.5秒を越えないように撮ります。例えば、最近の一般的なカメラであれば、ISO100、ISO200、ISO400、ISO800、ISO1600、ISO3200、ISO6400、ISO12800の8枚が撮影できると思います。
3.  次にノイズリダクション機能をオンにして1と同様に8枚撮影します。但し、今度は絞りf/5.6を使い、最低2秒以上の露出時間で撮ります。
4.  カメラによっては、絞りが大きく開かれるとrawの値を補正する機構が付いているものがあります、特にキャノンやニコンのカメラに多いようです。貴方のカメラにそうした機構が備わっているかどうか正しく知るには、写真を撮って計測するしかありません。絞りを開放（例えばf/1.7）にしてISO100でノイズリダクションをオフにして写真を撮り、上記1，2の写真と共に送ってもらいます。もしrawの値が補正されていることが分れば（或いは、貴方自身が計測して、それが分かったのであれば）、更に各ISO値で、露出時間0.5秒以下、開放値から1/3刻みの絞りで撮影した写真を送ってもらい、どの絞りまで開かれると補正機構が働くかを確認します。これはその確認のためには多くの写真撮影が必要になるということを意味します。しかし、絞りが大きく開かれるとrawの補正が行われてしまうことは差して重要な問題ではないので、悩む必要はありません。補正機構が付いていることが分っても、この作業が必ず必要ということもありません。ただ、時間と余裕があれば確認するのがいいでしょう。

　最低限、1で説明した写真8枚が必要ですが、2で説明した写真8枚、計16枚の写真と3で説明したrawの補正が行われているかどうかを確認するための写真1枚を撮ることを奨めます。補正が行われていることが確認されれば、更に3で説明した一連の写真を追加的に揃えることになりますが、かなりの枚数（例、50枚以上）になるので、無理は言えません。そして、それら写真全てを圧縮し、[filebin.net](https://filebin.net/)にアップロードして、そのリンクを[Github](https://github.co.jp/)のページか、当フォーラムに送って下さい。

　完全に飽和した画像は驚くほど高い圧縮が可能ですので、アップロードする前にファイルの圧縮（7‐Zip、ZIPなどで）をお忘れなく。例えば、Sony7M2で撮影した、完全に飽和した長時間露出、ノイズ低減機能オフの画像は10枚で234MBの大きさになりますが、ZIPを使えば1MBまで圧縮できます。

### 詳細

　正式なドキュメント、必要とされる写真の詳細、そして計測する方法に関しては、camconst.jsonの中のコメントを参照して下さい。

<https://github.com/Beep6581/RawTherapee/blob/master/rtengine/camconst.json>