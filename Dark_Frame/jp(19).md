<span style="color: #000000; background: none; overflow: hidden; page-break-after: avoid; font-size: 2.0em; font-family: Georgia,Times,serif; margin-top: 1em; margin-bottom: 0.25em; line-height: 1.3; padding: 0; border-bottom: 1px solid #AAAAAA;">ダークフレーム
</span>

　\[<https://en.wikipedia.org/wiki/Dark-frame_subtraction>　ダークフレーム減算処理\]（英語）は、熱や暗電流、固定パターンのノイズを処理する方法です。但し、ノイズの性格が違うので、高ISOノイズの補正には使えません。露出時間の長い（1秒以上）画像では、撮像センサーや周辺の電子的環境が均一ではないことが主原因で、非均一な熱雑音（ノイズ）が増えてきます。これを緩和するために、同じ条件で撮影した（但し、レンズキャップをはめたままで）
画像を1枚以上撮っておき、この画像データを元に修正します。但し、同じカメラで撮影されたraw画像だけが、ダークフレームとして使えます。出来れば、撮影時と同じ時に用意した方がいいでしょう。レンズキャップを付けて撮影するだけなので、設定を変える必要はありません。

　“ダークフレーム”パネルで、ノイズ低減のために使う画像を一枚特定することも出来ますが、ボックス下の“自動選択”をチェックし、RawTherapeeに修正に最適と考えられる画像を“[環境設定](Preferences/jp "wikilink")→画像処理タブ→ダークフレーム”で指定したディレクトリーから選ばせる方法もあります。RawTherapeeがディレクトリーにある全てのダークフレームをスキャンして、最適なダークフレームを選びます。そして、発見したダークフレームの数や、そのグループの数、そしてその平均値をテンプレートに表示します。ダークフレームの準備がまだであれば、準備を始めましょう。また、ダークフレームとして使えると思われる画像を見つけたら、サムネイルブラウザで右クリックし、ダークフレームの項目で“ダークフレームディレクトリーに移動”を選んで、移動出来ます。RawTherapeeは同じカメラ機種で撮られた、ISO値、露出時間、日付の違いが最小である、最適な画像を選びます。同じ特性を備えた画像が複数枚検出された場合は、その平均値が使われます。これによって遥かにノイズの少ない画像
に仕上げることが可能なので、同じ条件で実際に撮影された画像を4～6枚用意するのがいいでしょう。

　ダークフレームが特定（或いは、“自動選択”）されると、RawTherapeeがそこから全てのホットピクセ
ルの位置情報を取り出し、常に最終画像を修正します。この修正方法は、ホット／デッドピクセル
フィルターだけを使うより効果的ですが、機能するのはホットピクセル（白）に対しだけで、デッ
ドピクセル（黒）には使えません。

## 自動マッチングの論理

　ダークフレーム検索の鍵(dfInfo::key):

- カメラメーカー名
- 機種名
- ISO
- シャッター速度

　最適なダークフレームの選択に関わるのは2要素です：

- 上記の鍵が完全に一致する画像が複数あれば、焦点距離の短いものを選択
- 一致する画像が無ければ、全ての画像からISOとシャッター速度が同じで、焦点距離の短い画像を選択

## Badピクセル

　RawTherapeeはカメラ固有の[　Badピクセル](https://en.wikipedia.org/wiki/Defective_pixel)（英語）（常に黒色か白色、或いは特定色です）を修正できます。そのためには、これらピクセルのrawデータの座標を、テキストファイルに書き込む必要があります。各行に、ピクセルの座標を`x`<space>`y`<return>の形で書き込みます。

　**重要**：RawTherapeeは画像の上側と左側の境界線からピクセルを4つカットしています（その部分は正しく読めないからです）。従ってRawTherapeeのピクセルの座標を書く場合、このカット分を考慮して下さい。つまり、ピクセルの座標値x、yにそれぞれ4を加算します。

　Badピクセルのファイルはダークフレームのディレクトリーに入れます。“*環境設定　![<File:Preferences.png>](Preferences.png "File:Preferences.png")→画像処理→ダークフレーム*”で、それを設定して下さい。ファイル名は必ず、“メーカー名　機種名．badpixels”という形式で、正確な名称を付けます。例、`Pentax K220D.badpixels`。RawTherapeeが必要とするメーカー名、機種名は、raw画像を[画像編集タブタブで](The_Image_Editor_Tab/jp "wikilink")開いた際に、“画像の情報![Image:info.png](info.png "Image:info.png")”、ショートカット“**i**”で表示されるものと同じです。必ずダークフレームディレクトリーに入れることをお忘れなく。

　正しい手順を踏んだにも関わらず、上手くいかない場合は、バッドピクセルファイルがRawTherapeeに正しく読み込まれているかどうか、一旦プログラムを終了して確かめます。[ファイルパスで](File_Paths/jp "wikilink")説明されている“options”ファイルの“*Verbose=fals*e”を“*Verbose=true*”に変えて、RawTherapeeを再起動し、補正したい画像を開き、テキスト出力を見て下さい。そこで、仮に、“Pentax
K10D
のバッドピクセルファイルが見つかりません”というメッセージが現れれば、ファイル名が少し違っていたことになるので、直します。それで、機能するようならば、“*Verboss*”を“*false*”に戻します。

　ファイル名が正確である限り、記録されたBadピクセルは画像処理の際に修正されます。

## Badピクセルを探査するソフトウェア

　Badピクセルを探査するソフトがあります：

Dead Pixel Test
<http://rawtherapee.com/mirror/deadpixeltest.zip>

Pixel Fixer
<http://www.pixelfixer.org/>

　使用する場合は、4ピクセルのカットが入ることをお忘れなく。